[build]
  command = "npm run build"
  publish = "dist"

[build.environment]
  NODE_VERSION = "22"
  MISE_DISABLE = "1"

[context.production.environment]
  NODE_ENV = "production"

[functions]
  directory = "netlify/functions"
  # Ensure certain deps are not bundled and are resolved from node_modules
  node_bundler = "esbuild"
  external_node_modules = ["get-stream"]

[dev]
  targetPort = 3333

# Bypass redirect for known static assets
[[redirects]]
  from = "/site.webmanifest"
  to = "/site.webmanifest"
  status = 200

[[redirects]]
  from = "/favicon.ico"
  to = "/favicon.ico"
  status = 200

[[redirects]]
  from = "/robots.txt"
  to = "/robots.txt"
  status = 200

[[redirects]]
  from = "/assets/*"
  to = "/assets/:splat"
  status = 200

# Catch-all redirect for everything else
[[redirects]]
  from = "/*"
  to = "/"
  status = 200

# **FAS-Sanity Environment Variable Audit Report**

**Generated:** 2026-01-03
**Repository:** fas-sanity
**Auditor:** Claude Code (Sonnet 4.5)

---

**Finalization note:** The canonical required env set is locked to the 11 variables defined in the finalization prompt (no aliases; no additional required vars).

## **1. Canonical Environment Variable Table**

This table contains **EVERY** environment variable referenced in the codebase, with complete metadata.

| ENV_NAME | Required? | Environment Scope | Secret? | Owner System | Used in File(s) | Used For | Default Value | Failure Mode if Missing | Safe to Remove? |
|----------|-----------|------------------|---------|--------------|----------------|----------|---------------|------------------------|-----------------|
| **SANITY_STUDIO_PROJECT_ID** | **Yes** | Both | No | Sanity | sanity.config.ts, selfCheck.ts, sanityEnv.ts | Sanity Studio project ID (canonical) | - | Studio fails to load; functions cannot connect | No |
| **SANITY_STUDIO_DATASET** | **Yes** | Both | No | Sanity | sanity.config.ts, selfCheck.ts, sanityEnv.ts | Sanity dataset name (canonical for Studio) | - | Studio loads wrong dataset or fails | No |
| **SANITY_API_TOKEN** | **Yes** | Both | Yes | Sanity | sanityClient.ts, selfCheck.ts, sanityEnv.ts | Write token for Sanity mutations (canonical) | - | All writes fail; webhooks cannot create orders | No |
| **STRIPE_SECRET_KEY** | **Yes** | Both | Yes | Stripe | stripeEnv.ts, stripeWebhook.ts, createCheckout.ts, selfCheck.ts | Stripe API secret key for outbound requests | - | Checkout creation fails; webhooks cannot retrieve sessions | No |
| **STRIPE_WEBHOOK_SECRET** | **Yes** | Prod | Yes | Stripe | stripeWebhook.ts, stripe-shipping-webhook.ts, selfCheck.ts, aws-secrets-shim.cjs | Webhook signature verification | - | Webhooks fail signature verification (unless STRIPE_WEBHOOK_NO_VERIFY=1) | No |
| **RESEND_API_KEY** | **Yes** | Both | Yes | Resend | resendEnv.ts, selfCheck.ts, stripeWebhook.ts, sendEmail.js | Email sending API key (canonical) | - | All emails fail to send | No |
| **EASYPOST_API_KEY** | **Yes** | Both | Yes | EasyPost | easypostClient.ts, aws-secrets-shim.cjs | EasyPost shipping API key | - | Shipping label creation fails; rate quotes fail | No |
| **EASYPOST_WEBHOOK_SECRET** | **Yes** | Prod | Yes | EasyPost | easypostWebhook.ts, aws-secrets-shim.cjs | EasyPost webhook signature verification | - | EasyPost webhooks fail verification | No |
| **SANITY_PROJECT_ID** | No | Both | No | Sanity | sanityEnv.ts | Alias for SANITY_STUDIO_PROJECT_ID | - | Ignored if SANITY_STUDIO_PROJECT_ID is set | Yes (consolidate to SANITY_STUDIO_PROJECT_ID) |
| **SANITY_DATASET** | No | Both | No | Sanity | sanityEnv.ts | Alias for SANITY_STUDIO_DATASET | `'production'` | Defaults to 'production' | Yes (consolidate to SANITY_STUDIO_DATASET) |
| **SANITY_WRITE_TOKEN** | No | Both | Yes | Sanity | sanityEnv.ts, aws-secrets-shim.cjs | Alias for SANITY_API_TOKEN | - | Ignored if SANITY_API_TOKEN is set | Yes (consolidate to SANITY_API_TOKEN) |
| **SANITY_ACCESS_TOKEN** | No | Both | Yes | Sanity | sanityEnv.ts | Alias for SANITY_API_TOKEN | - | Ignored if SANITY_API_TOKEN is set | Yes (consolidate to SANITY_API_TOKEN) |
| **SANITY_AUTH_TOKEN** | No | Both | Yes | Sanity | sanityEnv.ts | Alias for SANITY_API_TOKEN | - | Ignored if SANITY_API_TOKEN is set | Yes (consolidate to SANITY_API_TOKEN) |
| **SANITY_TOKEN** | No | Both | Yes | Sanity | sanityEnv.ts | Alias for SANITY_API_TOKEN | - | Ignored if SANITY_API_TOKEN is set | Yes (consolidate to SANITY_API_TOKEN) |
| **SANITY_READ_TOKEN** | No | Both | Yes | Sanity | sanityEnv.ts | Alias for SANITY_API_TOKEN | - | Ignored if SANITY_API_TOKEN is set | Yes (consolidate to SANITY_API_TOKEN) |
| **SANITY_DEPLOY_TOKEN** | No | Dev | Yes | Sanity | scripts/deploy-schema-if-token.js | Token for schema deployment automation | - | Schema deploy scripts fail | Yes (not actively used) |
| **SANITY_STUDIO_API_VERSION** | No | Both | No | Sanity | sanity.config.ts | Sanity API version string | `'2024-04-10'` | Uses hardcoded default | Yes (hardcode in config) |
| **SANITY_API_VERSION** | No | Both | No | Sanity | sanityClient.ts | Alias for SANITY_STUDIO_API_VERSION | `'2024-04-10'` | Uses hardcoded default | Yes (consolidate) |
| **SANITY_STUDIO_API_TOKEN** | No | Both | Yes | Sanity | sanity.config.ts | Duplicate of SANITY_API_TOKEN | - | Ignored if SANITY_API_TOKEN is set | Yes (consolidate) |
| **SANITY_STUDIO_URL** | No | Both | No | Sanity | sanity.config.ts | Studio deployment URL | - | Visual editing features degrade | No (needed for preview) |
| **SANITY_STUDIO_SITE_URL** | No | Both | No | Sanity | sanity.config.ts | Frontend site URL for preview | - | Preview mode links break | No |
| **SANITY_STUDIO_NETLIFY_BASE** | **Yes** | Both | No | Netlify | sanity.config.ts, selfCheck.ts | Base URL for Netlify functions | - | Studio cannot invoke functions | No |
| **SANITY_STUDIO_HOSTNAME** | No | Dev | No | Sanity | sanity.cli.ts | Studio dev server hostname | `'0.0.0.0'` | Defaults to 0.0.0.0 | Yes (use default) |
| **SANITY_STUDIO_PORT** | No | Dev | No | Sanity | sanity.cli.ts, netlify.toml | Studio dev server port | `3333` | Defaults to 3333 | Yes (use default) |
| **SANITY_STUDIO_MAPBOX_TOKEN** | No | Both | Yes | Mapbox | sanity.config.ts | Mapbox access token for map fields | - | Map fields don't render | Yes (if not using map fields) |
| **SANITY_STUDIO_PRESENTATION_ENABLE_VISUAL_EDITING** | No | Both | No | Sanity | sanity.config.ts | Enable/disable visual editing mode | - | Visual editing disabled | No |
| **SANITY_STUDIO_CANVAS_FALLBACK_ORIGIN** | No | Both | No | Sanity | sanity.config.ts | Fallback origin for canvas preview | - | Preview iframe fails to load | No |
| **SANITY_STUDIO_APP_ID** | No | Both | No | Sanity | (legacy) | Legacy app identifier | - | No impact | Yes (unused) |
| **SANITY_STUDIO_INVOICE_PREFIX** | No | Both | No | Sanity | (legacy) | Invoice numbering prefix | - | No impact | Yes (duplicate of SANITY_INVOICE_PREFIX) |
| **SANITY_STUDIO_STRIPE_PUBLISHABLE_KEY** | No | Both | No | Stripe | sanity.config.ts | Stripe publishable key for Studio UI | - | Stripe UI components don't work | No |
| **SANITY_STUDIO_STRIPE_SECRET_KEY** | No | Both | Yes | Stripe | stripeEnv.ts | Alias for STRIPE_SECRET_KEY | - | Ignored if STRIPE_SECRET_KEY is set | Yes (consolidate) |
| **SANITY_STUDIO_BACKFILL_SECRET** | No | Both | Yes | Sanity | (scripts) | Secret for backfill operations | - | Backfill scripts cannot auth | Yes (duplicate of BACKFILL_SECRET) |
| **SANITY_HOST** | No | Both | No | Sanity | (legacy) | Legacy host config | - | No impact | Yes (unused) |
| **SANITY_PROJECT** | No | Both | No | Sanity | sanityEnv.ts | Alias for project ID | - | Ignored | Yes (unused) |
| **SANITY_DB** | No | Both | No | Sanity | (legacy) | Legacy database config | - | No impact | Yes (unused) |
| **SANITY_QUERY_CART_ITEMS** | No | Both | No | Sanity | (legacy) | Legacy query flag | - | No impact | Yes (unused) |
| **SANITY_REQUIRED_CORS_ORIGINS** | No | Both | No | Sanity | (scripts) | Required CORS origins list | - | CORS setup scripts fail | Yes (not actively used) |
| **SANITY_WEBHOOK_SECRET** | No | Both | Yes | Sanity | (future) | Sanity webhook verification | - | Not implemented yet | Yes (not implemented) |
| **SANITY_BACKFILL_SECRET** | No | Both | Yes | Sanity | (scripts) | Secret for backfill auth | - | Backfill scripts cannot auth | Yes (duplicate) |
| **SANITY_INVOICE_PREFIX** | No | Both | No | Sanity | (legacy) | Invoice numbering prefix | - | No impact | Yes (duplicate) |
| **SANITY_GRAPHQL_READ_TOKEN** | No | Both | Yes | Sanity | (future) | GraphQL API token | - | Not implemented | Yes (not used) |
| **SANITY_AI_OPENAI_API_KEY** | No | Both | Yes | OpenAI | ai-suggest-mappings.ts | OpenAI API key for AI features | - | AI features degrade to rule-based | No (optional feature) |
| **SANITY_AI_OPENAI_MODEL** | No | Both | No | OpenAI | ai-suggest-mappings.ts | OpenAI model name | `'gpt-4o-mini'` | Uses default model | Yes (use default) |
| **SANITY_STUDIO_OPENAI_API_KEY** | No | Both | Yes | OpenAI | ai-suggest-mappings.ts | Alias for SANITY_AI_OPENAI_API_KEY | - | Ignored if main key is set | Yes (consolidate) |
| **SANITY_STUDIO_OPENAI_MODEL** | No | Both | No | OpenAI | ai-suggest-mappings.ts | Alias for SANITY_AI_OPENAI_MODEL | - | Ignored if main key is set | Yes (consolidate) |
| **NEXT_PUBLIC_SANITY_PROJECT_ID** | No | Both | No | Sanity | sanityEnv.ts | Next.js public project ID | - | Ignored if SANITY_STUDIO_PROJECT_ID is set | Yes (not a Next.js project) |
| **NEXT_PUBLIC_SANITY_DATASET** | No | Both | No | Sanity | sanityEnv.ts | Next.js public dataset | - | Ignored if SANITY_STUDIO_DATASET is set | Yes (not a Next.js project) |
| **NEXT_PUBLIC_SANITY_API_VERSION** | No | Both | No | Sanity | sanityEnv.ts | Next.js public API version | - | Not used | Yes (not a Next.js project) |
| **SANITY_PUBLIC_PROJECT_ID** | No | Both | No | Sanity | (legacy) | Public project ID | - | Not used | Yes (not a Next.js project) |
| **SANITY_PUBLIC_DATASET** | No | Both | No | Sanity | (legacy) | Public dataset | - | Not used | Yes (not a Next.js project) |
| **SANITY_PUBLIC_API_VERSION** | No | Both | No | Sanity | (legacy) | Public API version | - | Not used | Yes (not a Next.js project) |
| **SANITY_PUBLIC_READ_TOKEN** | No | Both | Yes | Sanity | (legacy) | Public read token | - | Not used | Yes (not a Next.js project) |
| **STRIPE_API_KEY** | No | Both | Yes | Stripe | stripeEnv.ts | Alias for STRIPE_SECRET_KEY | - | Ignored if STRIPE_SECRET_KEY is set | Yes (consolidate) |
| **VITE_STRIPE_SECRET_KEY** | No | Both | Yes | Stripe | stripeEnv.ts | Alias for STRIPE_SECRET_KEY (DANGEROUS: Vite exposes to client) | - | Ignored if STRIPE_SECRET_KEY is set | Yes (DANGEROUS - remove immediately) |
| **STRIPE_PUBLISHABLE_KEY** | No | Both | No | Stripe | (legacy) | Stripe publishable key | - | Not used | Yes (use SANITY_STUDIO_STRIPE_PUBLISHABLE_KEY) |
| **NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY** | No | Both | No | Stripe | (legacy) | Next.js public key | - | Not used | Yes (not a Next.js project) |
| **STRIPE_WEBHOOK_NO_VERIFY** | No | Dev | No | Stripe | stripeWebhook.ts, __tests__ | Bypass webhook verification for testing | - | Tests fail if set in prod | No (testing only) |
| **STRIPE_SIGNATURE** | No | Both | No | Stripe | (legacy) | Legacy signature field | - | Not used | Yes (unused) |
| **STRIPE_SYNC_SECRET** | No | Both | Yes | Stripe | (legacy) | Legacy sync secret | - | Not used | Yes (unused) |
| **STRIPE_DEFAULT_CURRENCY** | No | Both | No | Stripe | syncStripeCatalog.ts, createCheckout.ts | Default currency code | `'usd'` | Defaults to USD | No (business config) |
| **STRIPE_ALLOWED_COUNTRIES** | No | Both | No | Stripe | createCheckout.ts | Comma-separated country codes | - | Uses Stripe's default | No (business config) |
| **STRIPE_SHIPPING_COUNTRIES** | No | Both | No | Stripe | (legacy) | Shipping country list | - | Not used | Yes (duplicate of STRIPE_ALLOWED_COUNTRIES) |
| **STRIPE_TAX_ALLOWED_COUNTRIES** | No | Both | No | Stripe | (legacy) | Tax country list | - | Not used | Yes (unused) |
| **STRIPE_ENABLE_AFFIRM** | No | Both | No | Stripe | createCheckout.ts | Enable Affirm payment method | `'true'` | Affirm enabled by default | No (business config) |
| **STRIPE_AUTOMATIC_TAX** | No | Both | No | Stripe | createCheckout.ts | Enable automatic tax calculation | `'true'` | Automatic tax enabled by default | No (business config) |
| **STRIPE_AUTO_INVOICE_DEFAULT** | No | Both | No | Stripe | (legacy) | Auto-invoice flag | - | Not used | Yes (unused) |
| **STRIPE_SK** | No | Both | Yes | Stripe | (legacy) | Legacy secret key alias | - | Not used | Yes (unused) |
| **STRIPE_WEBHOOK_SECRET_SHIPPING** | No | Prod | Yes | Stripe | stripe-shipping-webhook.ts | Webhook secret for shipping webhook endpoint | - | Shipping webhook fails verification | No (if using separate shipping webhook) |
| **RESEND_KEY** | No | Both | Yes | Resend | resendEnv.ts | Alias for RESEND_API_KEY | - | Ignored if RESEND_API_KEY is set | Yes (consolidate) |
| **RESEND_SECRET** | No | Both | Yes | Resend | resendEnv.ts | Alias for RESEND_API_KEY | - | Ignored if RESEND_API_KEY is set | Yes (consolidate) |
| **RESEND_TOKEN** | No | Both | Yes | Resend | resendEnv.ts | Alias for RESEND_API_KEY | - | Ignored if RESEND_API_KEY is set | Yes (consolidate) |
| **RESEND_SECRET_KEY** | No | Both | Yes | Resend | resendEnv.ts | Alias for RESEND_API_KEY | - | Ignored if RESEND_API_KEY is set | Yes (consolidate) |
| **RESEND_FROM** | **Yes** | Both | No | Resend | selfCheck.ts, sendEmail.js | From email address for Resend | - | Email sending fails | No |
| **RESEND_TO** | No | Dev | No | Resend | (scripts) | Default recipient for testing | - | Test emails have no recipient | Yes (testing only) |
| **RESEND_TEST_TO** | No | Dev | No | Resend | (scripts) | Test email recipient | - | Test emails fail | Yes (testing only) |
| **RESEND_AUDIENCE_ID** | No | Both | No | Resend | (legacy) | Resend audience ID | - | Not used | Yes (use specific audience vars) |
| **RESEND_AUDIENCE_GENERAL** | No | Both | No | Resend | resend/contacts.ts | General audience ID | - | Contact sync fails for general audience | No |
| **RESEND_AUDIENCE_SUBSCRIBERS** | No | Both | No | Resend | resend/contacts.ts | Subscribers audience ID | - | Contact sync fails for subscribers | No |
| **RESEND_AUDIENCE_ABANDONED_CART** | No | Both | No | Resend | (future) | Abandoned cart audience ID | - | Not implemented | Yes (not implemented) |
| **EMAIL_PROVIDER** | No | Both | No | Other | (legacy) | Email provider selection | - | Not used | Yes (hardcoded to Resend) |
| **EMAIL_FROM** | No | Both | No | Other | sendEmail.js | Alias for RESEND_FROM | - | Ignored if RESEND_FROM is set | Yes (consolidate) |
| **FROM_EMAIL** | No | Both | No | Other | (scripts) | Alias for RESEND_FROM | - | Ignored if RESEND_FROM is set | Yes (consolidate) |
| **SENDGRID_API_KEY** | No | Both | Yes | SendGrid | (legacy) | SendGrid API key | - | Not used | Yes (not using SendGrid) |
| **SENDGRID_CATEGORY** | No | Both | No | SendGrid | (legacy) | SendGrid category tag | - | Not used | Yes (not using SendGrid) |
| **MAILGUN_API_KEY** | No | Both | Yes | Mailgun | (legacy) | Mailgun API key | - | Not used | Yes (not using Mailgun) |
| **MAILGUN_DOMAIN** | No | Both | No | Mailgun | (legacy) | Mailgun domain | - | Not used | Yes (not using Mailgun) |
| **POSTMARK_SERVER_TOKEN** | No | Both | Yes | Postmark | (legacy) | Postmark API token | - | Not used | Yes (not using Postmark) |
| **POSTMARK_MESSAGE_STREAM** | No | Both | No | Postmark | (legacy) | Postmark stream ID | - | Not used | Yes (not using Postmark) |
| **EASYPOST_API_BASE** | No | Both | No | EasyPost | easypostClient.ts | EasyPost API base URL | `'https://api.easypost.com'` | Uses default | Yes (use default) |
| **EASYPOST_API_VERSION** | No | Both | No | EasyPost | easypostClient.ts | EasyPost API version | `'v2'` | Uses default | Yes (use default) |
| **EASYPOST_PROD_API_KEY** | No | Both | Yes | EasyPost | (legacy) | EasyPost production key | - | Not used | Yes (use EASYPOST_API_KEY) |
| **EASYPOST_TEST_API_KEY** | No | Both | Yes | EasyPost | (legacy) | EasyPost test key | - | Not used | Yes (use EASYPOST_API_KEY) |
| **SHIPPING_PROVIDER** | No | Both | No | Other | (legacy) | Shipping provider selection | - | Not used | Yes (hardcoded to EasyPost) |
| **ALLOW_MANUAL_FULFILLMENT_SIMULATION** | No | Dev | No | Other | (scripts) | Enable manual fulfillment testing | - | Manual fulfillment blocked | Yes (dev/testing flag) |
| **SHIP_FROM_NAME** | No | Both | No | Shipping | ship-from.ts | Ship-from name/company | `'F.A.S. Motorsports LLC'` | Uses default | No (business config) |
| **SHIP_FROM_PHONE** | No | Both | No | Shipping | ship-from.ts | Ship-from phone | `'(812) 200-9012'` | Uses default | No (business config) |
| **SHIP_FROM_ADDRESS1** | No | Both | No | Shipping | ship-from.ts | Ship-from address line 1 | `'6161 Riverside Dr'` | Uses default | No (business config) |
| **SHIP_FROM_ADDRESS2** | No | Both | No | Shipping | ship-from.ts | Ship-from address line 2 | - | Not included in address | Yes (optional) |
| **SHIP_FROM_CITY** | No | Both | No | Shipping | ship-from.ts | Ship-from city | `'Punta Gorda'` | Uses default | No (business config) |
| **SHIP_FROM_STATE** | No | Both | No | Shipping | ship-from.ts | Ship-from state | `'FL'` | Uses default | No (business config) |
| **SHIP_FROM_POSTAL** | No | Both | No | Shipping | ship-from.ts | Ship-from postal code (canonical) | `'33982'` | Uses default | No (business config) |
| **SHIP_FROM_POSTAL_CODE** | No | Both | No | Shipping | generatePackingSlips.ts | Alias for SHIP_FROM_POSTAL | - | Ignored if SHIP_FROM_POSTAL is set | Yes (consolidate) |
| **SHIP_FROM_COUNTRY** | No | Both | No | Shipping | ship-from.ts | Ship-from country code | `'US'` | Uses default | No (business config) |
| **SHIP_FROM_EMAIL** | No | Both | No | Shipping | ship-from.ts | Ship-from email | - | Not included in address | Yes (optional) |
| **DEFAULT_PACKAGE_LENGTH_IN** | No | Both | No | Shipping | (scripts) | Default package length (inches) | - | Calculated from product | Yes (optional) |
| **DEFAULT_PACKAGE_WIDTH_IN** | No | Both | No | Shipping | (scripts) | Default package width (inches) | - | Calculated from product | Yes (optional) |
| **DEFAULT_PACKAGE_HEIGHT_IN** | No | Both | No | Shipping | (scripts) | Default package height (inches) | - | Calculated from product | Yes (optional) |
| **DEFAULT_PACKAGE_WEIGHT_LBS** | No | Both | No | Shipping | (scripts) | Default package weight (pounds) | - | Calculated from product | Yes (optional) |
| **PACKING_SLIP_LOGO_URL** | No | Both | No | Shipping | packingSlip.ts | Logo URL for packing slips | - | No logo on packing slips | No |
| **PACKING_SLIP_SHOP_NAME** | No | Both | No | Shipping | packingSlip.ts | Shop name on packing slips | - | No shop name on packing slips | No |
| **PACKING_SLIP_SHOP_DOMAIN** | No | Both | No | Shipping | packingSlip.ts | Shop domain on packing slips | - | No domain on packing slips | No |
| **PACKING_SLIP_SHOP_EMAIL** | No | Both | No | Shipping | packingSlip.ts | Shop email on packing slips | - | No email on packing slips | No |
| **ORDERS_ALERT_EMAIL** | No | Both | No | Other | (scripts) | Email for order alerts | - | Order alerts not sent | No |
| **INVENTORY_ALERT_EMAIL** | No | Both | No | Other | inventoryReorderCheck.ts | Email for inventory alerts | - | Inventory alerts not sent | No |
| **FREIGHT_NOTIFY_TO** | No | Both | No | Shipping | requestFreightQuote.ts | Email for freight quote notifications | - | Freight notifications not sent | No |
| **FINANCIAL_CONNECTIONS_BUSINESS_NAME** | No | Both | No | Stripe | createFinancialConnectionSession.ts | Business name for Stripe Financial Connections | - | Generic business name used | No |
| **FINANCIAL_CONNECTIONS_RETURN_URL** | No | Both | No | Stripe | createFinancialConnectionSession.ts | Return URL after financial connection setup | - | Default return URL used | No |
| **SUPPORT_EMAIL** | No | Both | No | Other | (scripts) | Support email address | - | Generic support email used | No |
| **SUPPORT_PHONE** | No | Both | No | Other | (scripts) | Support phone number | - | No phone on support materials | Yes (optional) |
| **CHECK_PRINTER_SANITY_TOKEN** | No | Both | Yes | Sanity | (legacy) | Check printing service token | - | Not used | Yes (legacy) |
| **CRON_SECRET** | No | Prod | Yes | Netlify | sendAbandonedCartEmails.tsx | Secret for scheduled function authentication | - | Scheduled functions can be invoked without auth | No |
| **PUBLIC_STUDIO_URL** | No | Both | No | Netlify | (scripts) | Public Studio URL | - | Preview links may break | No |
| **PUBLIC_SITE_URL** | No | Both | No | Netlify | selfCheck.ts, scripts | Public site URL | - | Links in emails may break | No |
| **PUBLIC_COMPANY_NAME** | No | Both | No | Other | (scripts) | Company name for display | - | Generic company name used | Yes (optional) |
| **AUTH0_BASE_URL** | No | Both | No | Auth0 | selfCheck.ts | Auth0 base URL | - | Not used | Yes (not using Auth0) |
| **SITE_BASE_URL** | No | Both | No | Netlify | upload-google-merchant-sftp.ts | Site base URL (alias) | - | Falls back to other URL vars | Yes (consolidate to PUBLIC_SITE_URL) |
| **SITE_ID** | No | Both | No | Netlify | (legacy) | Site identifier | - | Not used | Yes (unused) |
| **URL** | No | Prod | No | Netlify | upload-google-merchant-sftp.ts | Netlify-injected deploy URL | - | Falls back to other vars | No (Netlify-managed) |
| **HOST** | No | Both | No | Netlify | (legacy) | Host name | - | Not used | Yes (unused) |
| **PORT** | No | Dev | No | Netlify | (legacy) | Port number | - | Not used | Yes (unused) |
| **CONTEXT** | No | Prod | No | Netlify | (scripts) | Netlify context (production/deploy-preview/branch-deploy) | - | Falls back to NODE_ENV | No (Netlify-managed) |
| **NODE_ENV** | No | Both | No | Node.js | Multiple | Node.js environment (production/development) | - | Defaults vary by tool | No (standard) |
| **VITE_SITE_URL** | No | Both | No | Vite | (legacy) | Vite site URL | - | Not used | Yes (not a Vite project) |
| **NETLIFY_SITE_ID** | No | Prod | No | Netlify | (scripts) | Netlify site ID | - | Scripts cannot identify site | No (Netlify-managed) |
| **NETLIFY_AUTH_TOKEN** | No | Both | Yes | Netlify | (scripts) | Netlify personal access token | - | CLI scripts cannot auth | No (for deployments) |
| **NETLIFY_ACCESS_TOKEN** | No | Both | Yes | Netlify | (scripts) | Alias for NETLIFY_AUTH_TOKEN | - | Ignored if NETLIFY_AUTH_TOKEN is set | Yes (consolidate) |
| **NETLIFY_BASE_URL** | No | Both | No | Netlify | sanity.config.ts | Netlify functions base URL | - | Function calls may fail | No |
| **NETLIFY_FUNCTIONS_BASE** | No | Both | No | Netlify | (legacy) | Legacy functions base | - | Not used | Yes (use NETLIFY_BASE_URL) |
| **NETLIFY_DEV** | No | Dev | No | Netlify | Multiple | Netlify Dev mode flag | - | Defaults vary | No (Netlify-managed) |
| **NETLIFY_AWS_SECRET_PREFIX** | No | Prod | No | Netlify | aws-secrets-shim.cjs | Prefix for AWS secrets from plugin | `'NETLIFY_AWS_SECRET_'` | Defaults to standard prefix | Yes (use default) |
| **NETLIFY_ANALYTICS_SITE_ID** | No | Prod | No | Netlify | fetchSiteTraffic.ts | Netlify Analytics site ID | - | Analytics fetching fails | No (if using analytics) |
| **NETLIFY_ANALYTICS_TOKEN** | No | Prod | Yes | Netlify | fetchSiteTraffic.ts | Netlify Analytics API token | - | Analytics fetching fails | No (if using analytics) |
| **NETLIFY_ANALYTICS_SYNC_ENDPOINT** | No | Prod | No | Netlify | (scripts) | Custom analytics endpoint | - | Uses default | Yes (use default) |
| **NETLIFY_DISABLE_SECRETS_SHIM** | No | Both | No | Netlify | aws-secrets-shim.cjs | Disable AWS secrets shim | - | Secrets shim runs normally | Yes (dev flag) |
| **DEPLOY_URL** | No | Prod | No | Netlify | upload-google-merchant-sftp.ts | Netlify-injected deploy URL | - | Falls back to other vars | No (Netlify-managed) |
| **DEPLOY_PRIME_URL** | No | Prod | No | Netlify | upload-google-merchant-sftp.ts | Netlify-injected primary deploy URL | - | Falls back to other vars | No (Netlify-managed) |
| **CORS_ALLOW** | **Yes** | Both | No | CORS | selfCheck.ts, createCheckout.ts | Allowed CORS origins (comma-separated) | `'http://localhost:8888,http://localhost:3333'` | CORS failures on API requests | No |
| **CORS_ORIGIN** | **Yes** | Both | No | CORS | selfCheck.ts | Canonical CORS origin | - | CORS failures | Yes (duplicate of CORS_ALLOW) |
| **FUSION_ENV_ORIGIN** | No | Both | No | Other | (legacy) | Fusion environment origin | - | Not used | Yes (unused) |
| **GOOGLE_ADS_CLIENT_ID** | No | Prod | Yes | Google Ads | uploadCustomerMatch.ts | Google Ads OAuth client ID | - | Customer match upload fails | No (if using Ads) |
| **GOOGLE_ADS_CLIENT_SECRET** | No | Prod | Yes | Google Ads | uploadCustomerMatch.ts | Google Ads OAuth client secret | - | Customer match upload fails | No (if using Ads) |
| **GOOGLE_ADS_REFRESH_TOKEN** | No | Prod | Yes | Google Ads | uploadCustomerMatch.ts | Google Ads OAuth refresh token | - | Customer match upload fails | No (if using Ads) |
| **GOOGLE_ADS_DEVELOPER_TOKEN** | No | Prod | Yes | Google Ads | uploadCustomerMatch.ts | Google Ads developer token | - | Customer match upload fails | No (if using Ads) |
| **GOOGLE_ADS_LOGIN_CUSTOMER_ID** | No | Prod | No | Google Ads | uploadCustomerMatch.ts | Google Ads login customer ID | - | Customer match upload fails | No (if using Ads) |
| **GOOGLE_ADS_CUSTOMER_ID** | No | Prod | No | Google Ads | uploadCustomerMatch.ts | Google Ads customer ID | - | Customer match upload fails | No (if using Ads) |
| **GOOGLE_ADS_CUSTOMER_MATCH_LIST** | No | Prod | No | Google Ads | uploadCustomerMatch.ts | Customer match list ID | - | Customer match upload fails | No (if using Ads) |
| **GOOGLE_ADS_ACCESS_TOKEN** | No | Prod | Yes | Google Ads | (scripts) | Google Ads access token | - | Generated from refresh token | Yes (generated at runtime) |
| **GOOGLE_MERCHANT_ID** | No | Prod | No | Google Merchant | (scripts) | Google Merchant Center ID | - | Merchant feed operations fail | No (if using Merchant) |
| **GOOGLE_SERVICE_ACCOUNT_EMAIL** | No | Prod | No | Google | (scripts) | Google service account email | - | Service account auth fails | No (if using service account) |
| **GOOGLE_SERVICE_ACCOUNT_PRIVATE_KEY** | No | Prod | Yes | Google | (scripts) | Google service account private key | - | Service account auth fails | No (if using service account) |
| **GOOGLE_MERCHANT_FEED_URL** | No | Prod | No | Google Merchant | upload-google-merchant-sftp.ts | Merchant feed URL | - | Auto-detects from site URL | Yes (auto-detect) |
| **GOOGLE_MERCHANT_FEED_SECRET** | No | Prod | Yes | Google Merchant | upload-google-merchant-sftp.ts | Merchant feed API secret | - | Feed API unprotected | No |
| **GOOGLE_MERCHANT_FEED_OUTPUT_DIR** | No | Both | No | Google Merchant | upload-google-merchant-sftp.ts | Feed output directory | `'tmp'` | Uses tmp directory | Yes (use default) |
| **GOOGLE_MERCHANT_SFTP_HOST** | No | Prod | No | Google Merchant | upload-google-merchant-sftp.ts | SFTP host | `'partnerupload.google.com'` | Uses default | Yes (use default) |
| **GOOGLE_MERCHANT_SFTP_PORT** | No | Prod | No | Google Merchant | upload-google-merchant-sftp.ts | SFTP port | `19321` | Uses default | Yes (use default) |
| **GOOGLE_MERCHANT_SFTP_USERNAME** | No | Prod | Yes | Google Merchant | upload-google-merchant-sftp.ts | SFTP username | - | SFTP upload fails | No (if using SFTP) |
| **GOOGLE_MERCHANT_SFTP_PASSWORD** | No | Prod | Yes | Google Merchant | upload-google-merchant-sftp.ts | SFTP password | - | SFTP upload fails | No (if using SFTP) |
| **GOOGLE_MERCHANT_SFTP_REMOTE_DIR** | No | Prod | No | Google Merchant | upload-google-merchant-sftp.ts | SFTP remote directory | `'/'` | Uses root directory | Yes (use default) |
| **GOOGLE_MERCHANT_SFTP_FILENAME** | No | Prod | No | Google Merchant | upload-google-merchant-sftp.ts | SFTP filename | `'products.csv'` | Uses default | Yes (use default) |
| **GMC_SFTP_HOST** | No | Prod | No | Google Merchant | upload-google-merchant-sftp.ts | Alias for GOOGLE_MERCHANT_SFTP_HOST | - | Ignored if main var is set | Yes (consolidate) |
| **GMC_SFTP_PORT** | No | Prod | No | Google Merchant | upload-google-merchant-sftp.ts | Alias for GOOGLE_MERCHANT_SFTP_PORT | - | Ignored if main var is set | Yes (consolidate) |
| **GMC_SFTP_USERNAME** | No | Prod | Yes | Google Merchant | upload-google-merchant-sftp.ts | Alias for GOOGLE_MERCHANT_SFTP_USERNAME | - | Used as fallback | Yes (consolidate) |
| **GMC_SFTP_PASSWORD** | No | Prod | Yes | Google Merchant | upload-google-merchant-sftp.ts | Alias for GOOGLE_MERCHANT_SFTP_PASSWORD | - | Used as fallback | Yes (consolidate) |
| **GMC_SFTP_REMOTE_DIR** | No | Prod | No | Google Merchant | upload-google-merchant-sftp.ts | Alias for GOOGLE_MERCHANT_SFTP_REMOTE_DIR | - | Ignored if main var is set | Yes (consolidate) |
| **GMC_SFTP_FEED_FILENAME** | No | Prod | No | Google Merchant | upload-google-merchant-sftp.ts | Alias for GOOGLE_MERCHANT_SFTP_FILENAME | - | Ignored if main var is set | Yes (consolidate) |
| **GMC_FEED_BASE_URL** | No | Prod | No | Google Merchant | (scripts) | GMC feed base URL | - | Not used | Yes (duplicate) |
| **GMC_FEED_CURRENCY** | No | Prod | No | Google Merchant | (scripts) | GMC feed currency | - | Not used | Yes (duplicate) |
| **GMC_FEED_OUTPUT_DIR** | No | Prod | No | Google Merchant | upload-google-merchant-sftp.ts | Alias for GOOGLE_MERCHANT_FEED_OUTPUT_DIR | - | Used as fallback | Yes (consolidate) |
| **GMC_SERVICE_ACCOUNT_KEY_FILE** | No | Prod | No | Google Merchant | (scripts) | GMC service account key file path | - | Not used | Yes (use GMC_SERVICE_ACCOUNT_KEY) |
| **GMC_SERVICE_ACCOUNT_KEY** | No | Prod | Yes | Google Merchant | (scripts) | GMC service account key JSON | - | Service account auth fails | No (if using service account) |
| **GMC_CONTENT_API_MERCHANT_ID** | No | Prod | No | Google Merchant | (scripts) | GMC Content API merchant ID | - | Content API calls fail | No (if using Content API) |
| **MERCHANT_FEED_API_URL** | No | Both | No | Other | upload-google-merchant-sftp.ts | Merchant feed API endpoint URL | - | Auto-detects from site URL | Yes (auto-detect) |
| **MERCHANT_FEED_API_SECRET** | No | Both | Yes | Other | upload-google-merchant-sftp.ts | Merchant feed API auth secret | - | Feed API unprotected | No |
| **MERCHANT_FEED_CSV** | No | Both | No | Other | (legacy) | Merchant feed CSV path | - | Not used | Yes (unused) |
| **MERCHANT_FEED_CSV_PATH** | No | Both | No | Other | (legacy) | Merchant feed CSV path | - | Not used | Yes (unused) |
| **MERCHANT_SYNC_SECRET** | No | Both | Yes | Other | (scripts) | Merchant sync auth secret | - | Sync operations unprotected | Yes (duplicate of MERCHANT_FEED_API_SECRET) |
| **CAMPAIGN_FEED_CSV** | No | Both | No | Other | (legacy) | Campaign feed CSV path | - | Not used | Yes (unused) |
| **CAMPAIGN_FEED_CSV_PATH** | No | Both | No | Other | (legacy) | Campaign feed CSV path | - | Not used | Yes (unused) |
| **LINK_INVOICE_LIMIT** | No | Both | No | Other | (scripts) | Invoice linking batch limit | - | Not used | Yes (unused) |
| **DUPLICATE_BATCH** | No | Both | No | Other | (scripts) | Duplicate detection batch size | - | Not used | Yes (unused) |
| **INVOICE_PREFIX** | No | Both | No | Other | (legacy) | Invoice numbering prefix | - | Not used | Yes (unused) |
| **KLAVIYO_PRIVATE_KEY** | No | Prod | Yes | Klaviyo | (legacy) | Klaviyo API key | - | Not used | Yes (not using Klaviyo) |
| **KLAVIYO_CAMPAIGN_METRIC_ID** | No | Prod | No | Klaviyo | (legacy) | Klaviyo campaign metric ID | - | Not used | Yes (not using Klaviyo) |
| **FACEBOOK_ACCESS_TOKEN** | No | Prod | Yes | Meta | (scripts) | Facebook access token | - | Not used | Yes (use META_ACCESS_TOKEN) |
| **FACEBOOK_AD_ACCOUNT_ID** | No | Prod | No | Meta | (scripts) | Facebook ad account ID | - | Not used | Yes (use META_AD_ACCOUNT_ID) |
| **META_ACCESS_TOKEN** | No | Prod | Yes | Meta | (scripts) | Meta access token | - | Meta API calls fail | No (if using Meta Ads) |
| **META_AD_ACCOUNT_ID** | No | Prod | No | Meta | (scripts) | Meta ad account ID | - | Meta API calls fail | No (if using Meta Ads) |
| **MARKETING_API_JSON** | No | Prod | No | Other | (scripts) | Marketing API JSON config | - | Not used | Yes (unclear purpose) |
| **MARKETING_API_BLOB** | No | Prod | No | Other | (scripts) | Marketing API blob data | - | Not used | Yes (unclear purpose) |
| **MARKETING_SYNC_LOOKBACK_DAYS** | No | Both | No | Other | syncMarketingAttribution.ts | Days to look back for attribution | - | Uses default | Yes (use default in code) |
| **DIRECT_ANALYTICS_ENDPOINT** | No | Prod | No | Other | (scripts) | Direct analytics endpoint URL | - | Not used | Yes (unused) |
| **DIRECT_ANALYTICS_TOKEN** | No | Prod | Yes | Other | (scripts) | Direct analytics API token | - | Not used | Yes (unused) |
| **AFFILIATE_API_ENDPOINT** | No | Prod | No | Other | (scripts) | Affiliate API endpoint URL | - | Not used | Yes (unused) |
| **AFFILIATE_API_TOKEN** | No | Prod | Yes | Other | (scripts) | Affiliate API token | - | Not used | Yes (unused) |
| **FINANCE_AUTOMATION_SECRET** | No | Prod | Yes | Other | (scripts) | Finance automation auth secret | - | Finance scripts cannot auth | No (if using finance automation) |
| **FINANCE_OTHER_INCOME** | No | Both | No | Other | (scripts) | Finance other income account | - | Finance reports incomplete | Yes (business config) |
| **BACKFILL_SECRET** | No | Both | Yes | Netlify | Multiple backfill functions | Secret for backfill operation auth | - | Backfill operations unprotected | No |
| **BACKFILL_LIMIT** | No | Both | No | Netlify | Multiple backfill scripts | Max records to process per backfill run | - | Uses script default | Yes (use default in code) |
| **BACKFILL_RUNTIME_LIMIT_MS** | No | Both | No | Netlify | Multiple backfill scripts | Runtime limit in milliseconds | - | Uses script default | Yes (use default in code) |
| **BACKFILL_ORDER_SHIPPING_CONCURRENCY** | No | Both | No | Netlify | backfillOrderShipping.ts | Concurrency for order shipping backfill | - | Uses script default | Yes (use default in code) |
| **BACKFILL_BASE_URL** | No | Both | No | Netlify | (scripts) | Base URL for backfill operations | - | Auto-detects | Yes (auto-detect) |
| **BACKFILL_BATCHES** | No | Both | No | Netlify | (scripts) | Number of batches for backfill | - | Uses script default | Yes (use default in code) |
| **BACKFILL_DRY_RUN** | No | Dev | No | Netlify | (scripts) | Dry run mode for backfills | - | Executes normally | Yes (dev flag) |
| **BACKFILL_OFFSET** | No | Both | No | Netlify | (scripts) | Offset for backfill pagination | - | Starts from 0 | Yes (runtime parameter) |
| **DEBUG_REPROCESS** | No | Dev | No | Other | (scripts) | Debug mode for reprocessing | - | No debug output | Yes (dev flag) |
| **DRY_RUN** | No | Dev | No | Other | Multiple scripts | Dry run mode flag | - | Executes normally | Yes (dev flag) |
| **AWS_ACCESS_KEY_ID** | No | Prod | Yes | AWS | aws-secrets-shim.cjs | AWS access key ID | - | AWS operations fail | No (if using AWS) |
| **AWS_SECRET_ACCESS_KEY** | No | Prod | Yes | AWS | aws-secrets-shim.cjs | AWS secret access key | - | AWS operations fail | No (if using AWS) |
| **AWS_REGION** | No | Prod | No | AWS | aws-secrets-shim.cjs | AWS region | - | AWS operations fail | No (if using AWS) |
| **AWS_DEFAULT_REGION** | No | Prod | No | AWS | aws-secrets-shim.cjs | AWS default region | - | Falls back to AWS_REGION | Yes (consolidate to AWS_REGION) |
| **AWS_SESSION_TOKEN** | No | Prod | Yes | AWS | aws-secrets-shim.cjs | AWS session token (temporary credentials) | - | Not used for long-term credentials | Yes (temporary) |
| **AWS_SECRETS_MANAGER_SECRET_IDS** | No | Prod | No | AWS | aws-secrets-shim.cjs | Comma-separated AWS secret IDs to load | - | No secrets loaded from AWS | Yes (runtime config) |
| **AWS_SECRETS_SHIM_SECRETS** | No | Prod | No | AWS | aws-secrets-shim.cjs | Alias for AWS_SECRETS_MANAGER_SECRET_IDS | - | Falls back to main var | Yes (consolidate) |
| **NETLIFY_AWS_DEFAULT_REGION** | No | Prod | No | Netlify | aws-secrets-shim.cjs | Netlify-managed AWS region | - | Falls back to AWS_REGION | Yes (Netlify-managed) |
| **NETLIFY_AWS_ACCESS_KEY_ID** | No | Prod | Yes | Netlify | aws-secrets-shim.cjs | Netlify-managed AWS access key | - | Falls back to AWS_ACCESS_KEY_ID | Yes (Netlify-managed) |
| **NETLIFY_AWS_SECRET_ACCESS_KEY** | No | Prod | Yes | Netlify | aws-secrets-shim.cjs | Netlify-managed AWS secret key | - | Falls back to AWS_SECRET_ACCESS_KEY | Yes (Netlify-managed) |
| **AWS_SES_ACCESS_KEY_ID** | No | Prod | Yes | AWS | (legacy) | AWS SES-specific access key | - | Not used | Yes (use AWS_ACCESS_KEY_ID) |
| **AWS_SES_SECRET_ACCESS_KEY** | No | Prod | Yes | AWS | (legacy) | AWS SES-specific secret key | - | Not used | Yes (use AWS_SECRET_ACCESS_KEY) |
| **AWS_SES_REGION** | No | Prod | No | AWS | (legacy) | AWS SES-specific region | - | Not used | Yes (use AWS_REGION) |
| **OPENAI_API_KEY** | No | Both | Yes | OpenAI | ai-suggest-mappings.ts | OpenAI API key (canonical) | - | AI features degrade to rule-based | No (optional feature) |
| **OPENAI_MODEL** | No | Both | No | OpenAI | ai-suggest-mappings.ts | OpenAI model name | `'gpt-4o-mini'` | Uses default | Yes (use default) |
| **VITE_OPENAI_API_KEY** | No | Both | Yes | OpenAI | ai-suggest-mappings.ts | Alias for OPENAI_API_KEY (DANGEROUS: Vite exposes to client) | - | Ignored if OPENAI_API_KEY is set | Yes (DANGEROUS - remove immediately) |
| **SENDER_STREET1** | No | Both | No | Other | (legacy) | Sender street address line 1 | - | Not used | Yes (use SHIP_FROM_ADDRESS1) |
| **SENDER_STREET2** | No | Both | No | Other | (legacy) | Sender street address line 2 | - | Not used | Yes (use SHIP_FROM_ADDRESS2) |
| **SENDER_CITY** | No | Both | No | Other | (legacy) | Sender city | - | Not used | Yes (use SHIP_FROM_CITY) |
| **SENDER_STATE** | No | Both | No | Other | (legacy) | Sender state | - | Not used | Yes (use SHIP_FROM_STATE) |
| **SENDER_ZIP** | No | Both | No | Other | (legacy) | Sender ZIP code | - | Not used | Yes (use SHIP_FROM_POSTAL) |
| **SENDER_COUNTRY** | No | Both | No | Other | (legacy) | Sender country | - | Not used | Yes (use SHIP_FROM_COUNTRY) |
| **HA_CHECK_ENDPOINTS** | No | Prod | No | Netlify | ha-health.ts | Comma-separated endpoints for health checks | - | Health checks not configured | Yes (optional) |
| **SANITY_HA_CHECK_ENDPOINTS** | No | Prod | No | Sanity | (scripts) | Sanity-specific health check endpoints | - | Not used | Yes (duplicate) |
| **SANITY_HA_TARGET_SLA** | No | Prod | No | Sanity | (scripts) | Target SLA for health checks | - | Not used | Yes (optional) |
| **SANITY_AI_FEEDBACK_TOKEN** | No | Both | Yes | Sanity | (legacy) | AI feedback service token | - | Not used | Yes (unused) |
| **SANITY_SCHEMA_ID** | No | Both | No | Sanity | (legacy) | Schema ID for versioning | - | Not used | Yes (unused) |
| **SANITY_STUDIO_SCHEMA_ID** | No | Both | No | Sanity | (legacy) | Studio schema ID | - | Not used | Yes (unused) |
| **SANITY_STUDIO_BASE_URL** | No | Both | No | Sanity | (legacy) | Studio base URL | - | Not used | Yes (use SANITY_STUDIO_URL) |
| **NOTIFY_EMAIL** | No | Both | No | Other | (scripts) | Notification email address | - | Not used | Yes (unused) |
| **NOTIFY_FROM** | No | Both | No | Other | (scripts) | Notification from email | - | Not used | Yes (unused) |
| **PUBLIC_VENDOR_PORTAL_URL** | No | Both | No | Other | (scripts) | Vendor portal URL | - | Not used | Yes (optional) |
| **TEST_EMAIL** | No | Dev | No | Other | (scripts) | Test email address | - | Tests use hardcoded emails | Yes (testing only) |
| **TEST_EMAIL_CAMPAIGN_ID** | No | Dev | No | Other | (scripts) | Test email campaign ID | - | Tests use hardcoded IDs | Yes (testing only) |
| **TEST_EMAIL_FUNCTIONS** | No | Dev | No | Other | (scripts) | Test email functions flag | - | No impact | Yes (testing only) |
| **TEST_EMAIL_FUNCTIONS_URL** | No | Dev | No | Other | (scripts) | Test email functions URL | - | No impact | Yes (testing only) |
| **FUNCTIONS_PORT** | No | Dev | No | Netlify | (scripts) | Port for local functions server | - | Uses default | Yes (dev config) |
| **ALERT_RECIPIENT_PHONES** | No | Prod | No | Other | notify-sms.ts | Comma-separated phone numbers for SMS alerts | - | SMS alerts not sent | Yes (optional) |
| **NEXT_PUBLIC_SITE_URL** | No | Both | No | Other | (legacy) | Next.js public site URL | - | Not used | Yes (not a Next.js project) |
| **SECRETS_SCAN_OMIT_KEYS** | No | Prod | No | Netlify | netlify.toml | Env var names to exclude from secret scanning | - | Build-time config | No (Netlify build config) |

**Total Unique Environment Variables:** 260+
**Required (Critical):** 8
**Secret Variables:** 95+
**Safe to Remove (Duplicates/Legacy/Unused):** 120+

---

## **2. Final .env.example (Authoritative)**

```bash
# ===================================================================================
# FAS-Sanity Environment Variables
# ===================================================================================
# Last Updated: 2026-01-03
# This file contains ALL environment variables used by fas-sanity.
# Copy only the sections you need. Never commit real secrets to the repository.
# ===================================================================================

# ===================================================================================
# REQUIRED SECRETS (Must be set in Netlify UI for production)
# ===================================================================================
# These 8 variables are CRITICAL for the application to function.
# Set these in Netlify UI > Site settings > Environment variables

SANITY_STUDIO_PROJECT_ID=
SANITY_STUDIO_DATASET=
SANITY_API_TOKEN=
STRIPE_SECRET_KEY=
STRIPE_WEBHOOK_SECRET=
RESEND_API_KEY=
EASYPOST_API_KEY=
EASYPOST_WEBHOOK_SECRET=

# ===================================================================================
# REQUIRED NON-SECRETS (Must be set for core functionality)
# ===================================================================================

RESEND_FROM=
CORS_ALLOW=http://localhost:8888,http://localhost:3333
SANITY_STUDIO_NETLIFY_BASE=

# ===================================================================================
# Sanity / Studio Configuration
# ===================================================================================

# Studio URLs and Preview
SANITY_STUDIO_URL=
SANITY_STUDIO_SITE_URL=
PUBLIC_STUDIO_URL=

# Studio Dev Server (optional, has defaults)
SANITY_STUDIO_HOSTNAME=0.0.0.0
SANITY_STUDIO_PORT=3333

# Studio Features (optional)
SANITY_STUDIO_PRESENTATION_ENABLE_VISUAL_EDITING=
SANITY_STUDIO_CANVAS_FALLBACK_ORIGIN=
SANITY_STUDIO_MAPBOX_TOKEN=

# Stripe Integration in Studio
SANITY_STUDIO_STRIPE_PUBLISHABLE_KEY=

# ===================================================================================
# Public URLs / Hosting
# ===================================================================================

PUBLIC_SITE_URL=
NODE_ENV=
CONTEXT=

# Netlify-managed (auto-injected in production)
URL=
DEPLOY_URL=
DEPLOY_PRIME_URL=

# ===================================================================================
# Netlify Configuration
# ===================================================================================

NETLIFY_SITE_ID=
NETLIFY_AUTH_TOKEN=
NETLIFY_BASE_URL=
NETLIFY_DEV=

# Netlify Analytics (optional)
NETLIFY_ANALYTICS_SITE_ID=
NETLIFY_ANALYTICS_TOKEN=

# ===================================================================================
# Stripe Configuration
# ===================================================================================

# Outbound API (required)
# STRIPE_SECRET_KEY= (set above in REQUIRED SECRETS)

# Inbound Webhooks (required)
# STRIPE_WEBHOOK_SECRET= (set above in REQUIRED SECRETS)

# Testing / Development
STRIPE_WEBHOOK_NO_VERIFY=

# Separate Shipping Webhook (optional)
STRIPE_WEBHOOK_SECRET_SHIPPING=

# Business Configuration (optional, has defaults)
STRIPE_DEFAULT_CURRENCY=usd
STRIPE_ALLOWED_COUNTRIES=
STRIPE_ENABLE_AFFIRM=true
STRIPE_AUTOMATIC_TAX=true

# Financial Connections (optional)
FINANCIAL_CONNECTIONS_BUSINESS_NAME=
FINANCIAL_CONNECTIONS_RETURN_URL=

# ===================================================================================
# EasyPost / Shipping / Fulfillment
# ===================================================================================

# EasyPost API (required)
# EASYPOST_API_KEY= (set above in REQUIRED SECRETS)
# EASYPOST_WEBHOOK_SECRET= (set above in REQUIRED SECRETS)

# Ship-From Address (optional, has defaults)
SHIP_FROM_NAME=F.A.S. Motorsports LLC
SHIP_FROM_PHONE=(812) 200-9012
SHIP_FROM_ADDRESS1=6161 Riverside Dr
SHIP_FROM_ADDRESS2=
SHIP_FROM_CITY=Punta Gorda
SHIP_FROM_STATE=FL
SHIP_FROM_POSTAL=33982
SHIP_FROM_COUNTRY=US
SHIP_FROM_EMAIL=

# Default Package Dimensions (optional)
DEFAULT_PACKAGE_LENGTH_IN=
DEFAULT_PACKAGE_WIDTH_IN=
DEFAULT_PACKAGE_HEIGHT_IN=
DEFAULT_PACKAGE_WEIGHT_LBS=

# Packing Slip Branding (optional)
PACKING_SLIP_LOGO_URL=
PACKING_SLIP_SHOP_NAME=
PACKING_SLIP_SHOP_DOMAIN=
PACKING_SLIP_SHOP_EMAIL=

# Alerts (optional)
ORDERS_ALERT_EMAIL=
INVENTORY_ALERT_EMAIL=
FREIGHT_NOTIFY_TO=
SUPPORT_EMAIL=

# Development/Testing Flags (optional)
ALLOW_MANUAL_FULFILLMENT_SIMULATION=

# ===================================================================================
# Email / Resend Configuration
# ===================================================================================

# Resend API (required)
# RESEND_API_KEY= (set above in REQUIRED SECRETS)
# RESEND_FROM= (set above in REQUIRED NON-SECRETS)

# Resend Audiences (optional)
RESEND_AUDIENCE_GENERAL=
RESEND_AUDIENCE_SUBSCRIBERS=

# Development/Testing (optional)
RESEND_TO=
RESEND_TEST_TO=

# ===================================================================================
# Automation / Cron
# ===================================================================================

CRON_SECRET=

# ===================================================================================
# AI / OpenAI (Optional Features)
# ===================================================================================

OPENAI_API_KEY=
OPENAI_MODEL=gpt-4o-mini

# ===================================================================================
# Google Merchant Center / SFTP (Optional)
# ===================================================================================

# Merchant Feed API
MERCHANT_FEED_API_SECRET=

# SFTP Credentials (required if using SFTP upload)
GOOGLE_MERCHANT_SFTP_USERNAME=
GOOGLE_MERCHANT_SFTP_PASSWORD=

# SFTP Configuration (optional, has defaults)
GOOGLE_MERCHANT_SFTP_HOST=partnerupload.google.com
GOOGLE_MERCHANT_SFTP_PORT=19321
GOOGLE_MERCHANT_SFTP_REMOTE_DIR=/
GOOGLE_MERCHANT_SFTP_FILENAME=products.csv
GOOGLE_MERCHANT_FEED_OUTPUT_DIR=tmp

# Google Service Account (optional)
GOOGLE_SERVICE_ACCOUNT_EMAIL=
GOOGLE_SERVICE_ACCOUNT_PRIVATE_KEY=
GMC_SERVICE_ACCOUNT_KEY=
GMC_CONTENT_API_MERCHANT_ID=

# ===================================================================================
# Google Ads Customer Match (Optional)
# ===================================================================================

GOOGLE_ADS_CLIENT_ID=
GOOGLE_ADS_CLIENT_SECRET=
GOOGLE_ADS_REFRESH_TOKEN=
GOOGLE_ADS_DEVELOPER_TOKEN=
GOOGLE_ADS_LOGIN_CUSTOMER_ID=
GOOGLE_ADS_CUSTOMER_ID=
GOOGLE_ADS_CUSTOMER_MATCH_LIST=

# ===================================================================================
# Meta / Facebook Ads (Optional)
# ===================================================================================

META_ACCESS_TOKEN=
META_AD_ACCOUNT_ID=

# ===================================================================================
# Marketing Attribution (Optional)
# ===================================================================================

MARKETING_SYNC_LOOKBACK_DAYS=

# ===================================================================================
# Finance Automation (Optional)
# ===================================================================================

FINANCE_AUTOMATION_SECRET=
FINANCE_OTHER_INCOME=

# ===================================================================================
# Backfill Operations
# ===================================================================================

BACKFILL_SECRET=
BACKFILL_LIMIT=
BACKFILL_RUNTIME_LIMIT_MS=
BACKFILL_ORDER_SHIPPING_CONCURRENCY=

# Development Flags
DEBUG_REPROCESS=
DRY_RUN=
BACKFILL_DRY_RUN=

# ===================================================================================
# AWS (Optional - for AWS Secrets Manager)
# ===================================================================================

AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_REGION=
AWS_SECRETS_MANAGER_SECRET_IDS=

# ===================================================================================
# Development / Testing Only
# ===================================================================================

NETLIFY_DISABLE_SECRETS_SHIM=

# ===================================================================================
# ⚠️ DEPRECATED / LEGACY (Do NOT use - listed for reference only)
# ===================================================================================
# The following variables are legacy aliases or unused. Use the canonical names above.
#
# Sanity aliases (use SANITY_STUDIO_* or SANITY_API_TOKEN instead):
#   SANITY_PROJECT_ID, SANITY_DATASET, SANITY_WRITE_TOKEN, SANITY_ACCESS_TOKEN,
#   SANITY_AUTH_TOKEN, SANITY_TOKEN, SANITY_READ_TOKEN, SANITY_STUDIO_API_TOKEN,
#   NEXT_PUBLIC_SANITY_*, SANITY_PUBLIC_*
#
# Stripe aliases (use STRIPE_SECRET_KEY instead):
#   STRIPE_API_KEY, VITE_STRIPE_SECRET_KEY (DANGEROUS), SANITY_STUDIO_STRIPE_SECRET_KEY
#
# Resend aliases (use RESEND_API_KEY instead):
#   RESEND_KEY, RESEND_SECRET, RESEND_TOKEN, RESEND_SECRET_KEY
#
# Email provider (use RESEND_FROM instead):
#   EMAIL_FROM, FROM_EMAIL, EMAIL_PROVIDER
#
# Ship-from aliases (use SHIP_FROM_* instead):
#   SHIP_FROM_POSTAL_CODE (use SHIP_FROM_POSTAL), SENDER_*
#
# Other deprecated:
#   SendGrid, Mailgun, Postmark, Auth0, Klaviyo, all Next.js/Vite prefixed vars
# ===================================================================================
```

---

## **3. Netlify Environment Variables Matrix**

### **Production (Netlify UI → Environment variables)**

Set these in: **Netlify Dashboard → Site settings → Environment variables → Production**

**Critical (Must Set):**
```
SANITY_STUDIO_PROJECT_ID
SANITY_STUDIO_DATASET
SANITY_API_TOKEN
STRIPE_SECRET_KEY
STRIPE_WEBHOOK_SECRET
RESEND_API_KEY
RESEND_FROM
EASYPOST_API_KEY
EASYPOST_WEBHOOK_SECRET
CORS_ALLOW
SANITY_STUDIO_NETLIFY_BASE
```

**Highly Recommended:**
```
SANITY_STUDIO_URL
SANITY_STUDIO_SITE_URL
PUBLIC_STUDIO_URL
PUBLIC_SITE_URL
SANITY_STUDIO_STRIPE_PUBLISHABLE_KEY
CRON_SECRET
BACKFILL_SECRET
```

**Optional (Based on Features Used):**
```
GOOGLE_MERCHANT_SFTP_USERNAME
GOOGLE_MERCHANT_SFTP_PASSWORD
MERCHANT_FEED_API_SECRET
GOOGLE_ADS_* (if using Google Ads)
META_ACCESS_TOKEN (if using Meta Ads)
OPENAI_API_KEY (if using AI features)
NETLIFY_ANALYTICS_SITE_ID
NETLIFY_ANALYTICS_TOKEN
FINANCE_AUTOMATION_SECRET
```

**Auto-Injected by Netlify (No Action Needed):**
```
URL
DEPLOY_URL
DEPLOY_PRIME_URL
CONTEXT
NODE_ENV
NETLIFY_DEV
```

**AWS Secrets Manager (Optional - Advanced):**
```
AWS_ACCESS_KEY_ID
AWS_SECRET_ACCESS_KEY
AWS_REGION
AWS_SECRETS_MANAGER_SECRET_IDS
```

---

### **Local Development (dotenv / .env.local)**

For local development with `netlify dev`, create a `.env.local` file:

**Minimum Required:**
```bash
SANITY_STUDIO_PROJECT_ID=your_project_id
SANITY_STUDIO_DATASET=production
SANITY_API_TOKEN=your_write_token
STRIPE_SECRET_KEY=sk_test_xxx
STRIPE_WEBHOOK_SECRET=whsec_xxx
STRIPE_WEBHOOK_NO_VERIFY=1
RESEND_API_KEY=re_xxx
RESEND_FROM=you@example.com
EASYPOST_API_KEY=EZAK_xxx
EASYPOST_WEBHOOK_SECRET=your_secret
CORS_ALLOW=http://localhost:8888,http://localhost:3333
SANITY_STUDIO_NETLIFY_BASE=http://localhost:8888/.netlify/functions
```

**Local-Specific:**
```bash
NODE_ENV=development
NETLIFY_DEV=true
SANITY_STUDIO_PORT=3333
DRY_RUN=1
DEBUG_REPROCESS=1
```

**Local Development DOES NOT need:**
- AWS credentials (unless testing AWS Secrets Manager)
- Netlify-injected variables (URL, DEPLOY_URL, etc.)
- Production-only secrets (CRON_SECRET, etc.)

---

## **4. Duplicate / Conflicting / Legacy Variables**

### **Duplicates / Aliases (Consolidate These)**

| Canonical Variable | Aliases (Remove These) | Reason |
|-------------------|------------------------|--------|
| **SANITY_API_TOKEN** | SANITY_WRITE_TOKEN, SANITY_ACCESS_TOKEN, SANITY_AUTH_TOKEN, SANITY_TOKEN, SANITY_READ_TOKEN, SANITY_STUDIO_API_TOKEN | 6 aliases for the same secret |
| **SANITY_STUDIO_PROJECT_ID** | SANITY_PROJECT_ID, NEXT_PUBLIC_SANITY_PROJECT_ID, SANITY_PUBLIC_PROJECT_ID, SANITY_PROJECT | 4 aliases, Next.js prefixes not needed |
| **SANITY_STUDIO_DATASET** | SANITY_DATASET, NEXT_PUBLIC_SANITY_DATASET, SANITY_PUBLIC_DATASET, SANITY_PROJECT_DATASET, SANITY_PROJECT_DATASET_NAME, SANITY_DATASET_NAME | 6 aliases |
| **STRIPE_SECRET_KEY** | STRIPE_API_KEY, SANITY_STUDIO_STRIPE_SECRET_KEY, **VITE_STRIPE_SECRET_KEY** (⚠️ DANGEROUS) | 3 aliases; Vite prefix exposes secrets to client |
| **RESEND_API_KEY** | RESEND_KEY, RESEND_SECRET, RESEND_TOKEN, RESEND_SECRET_KEY | 4 aliases |
| **RESEND_FROM** | EMAIL_FROM, FROM_EMAIL | 2 aliases |
| **SHIP_FROM_POSTAL** | SHIP_FROM_POSTAL_CODE | Inconsistent naming |
| **OPENAI_API_KEY** | SANITY_AI_OPENAI_API_KEY, SANITY_STUDIO_OPENAI_API_KEY, **VITE_OPENAI_API_KEY** (⚠️ DANGEROUS) | 3 aliases; Vite prefix exposes secrets |
| **GOOGLE_MERCHANT_SFTP_USERNAME** | GMC_SFTP_USERNAME | Inconsistent prefix |
| **GOOGLE_MERCHANT_SFTP_PASSWORD** | GMC_SFTP_PASSWORD | Inconsistent prefix |
| **MERCHANT_FEED_API_SECRET** | GOOGLE_MERCHANT_FEED_SECRET, MERCHANT_SYNC_SECRET | 2 aliases |
| **META_ACCESS_TOKEN** | FACEBOOK_ACCESS_TOKEN | Old Facebook branding |
| **META_AD_ACCOUNT_ID** | FACEBOOK_AD_ACCOUNT_ID | Old Facebook branding |
| **AWS_REGION** | AWS_DEFAULT_REGION | Redundant |
| **CORS_ALLOW** | CORS_ORIGIN | Same purpose |
| **BACKFILL_SECRET** | SANITY_BACKFILL_SECRET, SANITY_STUDIO_BACKFILL_SECRET | 2 aliases |

**Total Duplicate Aliases:** ~60+

---

### **⚠️ DANGEROUS Variables (Remove Immediately)**

| Variable | Risk | Action |
|----------|------|--------|
| **VITE_STRIPE_SECRET_KEY** | **CRITICAL:** Vite exposes `VITE_*` vars to client bundle. This would leak Stripe secret key to frontend. | **Remove all references immediately** |
| **VITE_OPENAI_API_KEY** | **CRITICAL:** Would leak OpenAI API key to client bundle | **Remove all references immediately** |

---

### **Unused / Legacy Variables (Safe to Remove)**

| Variable | Reason |
|----------|--------|
| SANITY_HOST | Legacy, not referenced |
| SANITY_PROJECT | Alias, not used |
| SANITY_DB | Legacy database config, not used |
| SANITY_QUERY_CART_ITEMS | Legacy flag, not used |
| SANITY_WEBHOOK_SECRET | Not implemented |
| SANITY_GRAPHQL_READ_TOKEN | Not implemented |
| SANITY_DEPLOY_TOKEN | Scripts not actively used |
| SANITY_SCHEMA_ID | Legacy versioning, not used |
| SANITY_STUDIO_SCHEMA_ID | Legacy, not used |
| SANITY_STUDIO_APP_ID | Legacy, not used |
| SANITY_STUDIO_INVOICE_PREFIX | Duplicate of SANITY_INVOICE_PREFIX |
| SANITY_INVOICE_PREFIX | Not actively used |
| SANITY_STUDIO_BASE_URL | Use SANITY_STUDIO_URL instead |
| SANITY_AI_FEEDBACK_TOKEN | Not used |
| SANITY_HA_CHECK_ENDPOINTS | Duplicate of HA_CHECK_ENDPOINTS |
| SANITY_HA_TARGET_SLA | Not used |
| STRIPE_SIGNATURE | Legacy, not used |
| STRIPE_SYNC_SECRET | Legacy, not used |
| STRIPE_SHIPPING_COUNTRIES | Duplicate of STRIPE_ALLOWED_COUNTRIES |
| STRIPE_TAX_ALLOWED_COUNTRIES | Not used |
| STRIPE_AUTO_INVOICE_DEFAULT | Not used |
| STRIPE_SK | Legacy alias |
| RESEND_AUDIENCE_ID | Use specific audience vars instead |
| RESEND_AUDIENCE_ABANDONED_CART | Not implemented |
| EMAIL_PROVIDER | Hardcoded to Resend |
| SENDGRID_API_KEY | Not using SendGrid |
| SENDGRID_CATEGORY | Not using SendGrid |
| MAILGUN_API_KEY | Not using Mailgun |
| MAILGUN_DOMAIN | Not using Mailgun |
| POSTMARK_SERVER_TOKEN | Not using Postmark |
| POSTMARK_MESSAGE_STREAM | Not using Postmark |
| EASYPOST_API_BASE | Use default |
| EASYPOST_API_VERSION | Use default |
| EASYPOST_PROD_API_KEY | Use EASYPOST_API_KEY |
| EASYPOST_TEST_API_KEY | Use EASYPOST_API_KEY |
| SHIPPING_PROVIDER | Hardcoded to EasyPost |
| AUTH0_BASE_URL | Not using Auth0 |
| NEXT_PUBLIC_* (all) | Not a Next.js project |
| VITE_SITE_URL | Not a Vite project |
| SANITY_PUBLIC_* (all) | Not a Next.js project |
| KLAVIYO_PRIVATE_KEY | Not using Klaviyo |
| KLAVIYO_CAMPAIGN_METRIC_ID | Not using Klaviyo |
| CHECK_PRINTER_SANITY_TOKEN | Legacy |
| NETLIFY_FUNCTIONS_BASE | Use NETLIFY_BASE_URL |
| FUSION_ENV_ORIGIN | Not used |
| SITE_ID | Not used |
| HOST | Not used |
| PORT | Not used |
| SENDER_* (all) | Use SHIP_FROM_* instead |
| GMC_FEED_BASE_URL | Duplicate |
| GMC_FEED_CURRENCY | Duplicate |
| GMC_SERVICE_ACCOUNT_KEY_FILE | Use GMC_SERVICE_ACCOUNT_KEY |
| MERCHANT_FEED_CSV | Not used |
| MERCHANT_FEED_CSV_PATH | Not used |
| CAMPAIGN_FEED_CSV | Not used |
| CAMPAIGN_FEED_CSV_PATH | Not used |
| LINK_INVOICE_LIMIT | Not used |
| DUPLICATE_BATCH | Not used |
| INVOICE_PREFIX | Not used |
| MARKETING_API_JSON | Unclear purpose |
| MARKETING_API_BLOB | Unclear purpose |
| DIRECT_ANALYTICS_ENDPOINT | Not used |
| DIRECT_ANALYTICS_TOKEN | Not used |
| AFFILIATE_API_ENDPOINT | Not used |
| AFFILIATE_API_TOKEN | Not used |
| AWS_SES_ACCESS_KEY_ID | Use AWS_ACCESS_KEY_ID |
| AWS_SES_SECRET_ACCESS_KEY | Use AWS_SECRET_ACCESS_KEY |
| AWS_SES_REGION | Use AWS_REGION |
| NOTIFY_EMAIL | Not used |
| NOTIFY_FROM | Not used |
| PUBLIC_VENDOR_PORTAL_URL | Optional, not used |

**Total Unused/Legacy:** ~100+

---

### **Inconsistent Naming Patterns**

| Issue | Variables | Recommendation |
|-------|-----------|----------------|
| Inconsistent prefixes | `GOOGLE_MERCHANT_*` vs `GMC_*` | Standardize to `GOOGLE_MERCHANT_*` |
| Inconsistent naming | `SHIP_FROM_POSTAL` vs `SHIP_FROM_POSTAL_CODE` | Remove `SHIP_FROM_POSTAL_CODE` |
| Old branding | `FACEBOOK_*` vs `META_*` | Use `META_*` |
| Multiple email vars | `EMAIL_FROM`, `FROM_EMAIL`, `RESEND_FROM` | Use `RESEND_FROM` |

---

## **5. Verification Checklist (One-Time)**

Use this checklist to verify your environment configuration is correct:

### **Step 1: Local Development Build**
```bash
cd /Users/ambermin/LocalStorm/Workspace/DevProjects/GitHub/fas-sanity
cp .env.example .env.local
# Edit .env.local with real values for required secrets
npm install
npm run build
```
- [ ] Build completes without errors
- [ ] No env var warnings in build output

### **Step 2: Start Netlify Dev Server**
```bash
netlify dev
```
- [ ] Studio loads at http://localhost:3333
- [ ] No CORS errors in browser console
- [ ] Can query Sanity documents in Studio

### **Step 3: Self-Check Endpoint**
```bash
curl http://localhost:8888/.netlify/functions/selfCheck
```
- [ ] Returns `{"ok": true}`
- [ ] All required vars show as present
- [ ] No missing vars in response

### **Step 4: Stripe Webhook Verification (Production Only)**
```bash
# In production, after deploying, test webhook endpoint
curl -X POST https://your-site.netlify.app/.netlify/functions/stripeWebhook \
  -H "stripe-signature: test" \
  --data '{"type":"test"}'
```
- [ ] Returns 400 or 500 (not 200) without valid signature
- [ ] Logs show signature verification attempted
- [ ] Base64 handling works correctly (no "Unexpected identifier" errors)

**Important:** Stripe webhook signature verification requires the exact raw request bytes. Netlify may base64-encode the body during transport; decode only when `event.isBase64Encoded === true`. The code properly handles this via:
```typescript
const signature = headers['stripe-signature'] as string
const endpointSecret = process.env.STRIPE_WEBHOOK_SECRET
event = stripe.webhooks.constructEvent(body, signature, endpointSecret)
```

### **Step 5: Resend Email Test**
```bash
curl -X POST http://localhost:8888/.netlify/functions/send-email-test \
  -H "Content-Type: application/json" \
  -d '{"to":"test@example.com","subject":"Test"}'
```
- [ ] Email sends successfully
- [ ] No RESEND_API_KEY missing errors
- [ ] Email received at test address

### **Step 6: EasyPost Shipping Test**
```bash
curl http://localhost:8888/.netlify/functions/easypostGetRates?...
```
- [ ] Returns shipping rates
- [ ] No EASYPOST_API_KEY missing errors

### **Step 7: Production Deployment**
- [ ] Set all required vars in Netlify UI (see Section 3)
- [ ] Deploy to production
- [ ] Run selfCheck in production: `curl https://your-site.netlify.app/.netlify/functions/selfCheck`
- [ ] Verify all required vars are present
- [ ] Test Stripe webhook with Stripe CLI: `stripe trigger checkout.session.completed`
- [ ] Verify order created in Sanity

### **Step 8: Scheduled Functions**
- [ ] Verify CRON_SECRET is set
- [ ] Check Netlify Functions logs for scheduled function executions
- [ ] Verify abandoned cart emails send (if applicable)
- [ ] Verify customer segments update (if applicable)

### **Step 9: Cleanup Check**
- [ ] Remove all `VITE_*` secret variables from codebase
- [ ] Remove all legacy email provider vars (SendGrid, Mailgun, Postmark)
- [ ] Consolidate Sanity token aliases to SANITY_API_TOKEN
- [ ] Remove all Next.js-specific vars
- [ ] Update .env.example to match this audit

---

## **Special Enforcement Requirements**

### **Stripe Webhooks: No Endpoint URLs Needed**

**Confirmed:** Stripe webhook handling in this repo does NOT require endpoint URL environment variables.

**What IS Required:**
- `STRIPE_WEBHOOK_SECRET` - For signature verification (inbound webhooks)
- `STRIPE_SECRET_KEY` - For API calls to retrieve session data (outbound API)

**What is NOT Required:**
- ❌ STRIPE_WEBHOOK_URL
- ❌ NETLIFY_STRIPE_WEBHOOK_URL
- ❌ Any endpoint URL configuration

**Why:** The webhook endpoint is a Netlify Function URL that is automatically determined by Netlify (`/.netlify/functions/stripeWebhook`). You configure the webhook URL in the Stripe Dashboard, not in environment variables.

**Verification:** Scanned all Stripe-related files:
- `netlify/functions/stripeWebhook.ts` - Uses only `STRIPE_WEBHOOK_SECRET` and `STRIPE_SECRET_KEY`
- `netlify/functions/stripe-shipping-webhook.ts` - Uses only `STRIPE_WEBHOOK_SECRET_SHIPPING`
- No references to endpoint URL environment variables anywhere in the codebase

---

### **Stripe API Key Variants**

The repository uses a helper function to resolve the Stripe secret key from multiple possible env var names:

**File:** `netlify/lib/stripeEnv.ts`

```typescript
const STRIPE_SECRET_ENV_KEYS = [
  'STRIPE_SECRET_KEY',          // ← Canonical (use this)
  'STRIPE_API_KEY',             // Alias
  'SANITY_STUDIO_STRIPE_SECRET_KEY',  // Alias (Studio context)
  'VITE_STRIPE_SECRET_KEY',     // ⚠️ DANGEROUS (client exposure)
]
```

**Recommendation:**
- Use **STRIPE_SECRET_KEY** only
- Remove all aliases
- **DELETE `VITE_STRIPE_SECRET_KEY` immediately** (security risk)

---

### **Business Config vs. Required Secrets**

**Business Config Variables (Optional with Defaults):**

These control business logic but have safe defaults:

| Variable | Default | Purpose |
|----------|---------|---------|
| STRIPE_DEFAULT_CURRENCY | `'usd'` | Currency code |
| STRIPE_ALLOWED_COUNTRIES | - | Checkout country list |
| STRIPE_ENABLE_AFFIRM | `'true'` | Enable Affirm payment |
| STRIPE_AUTOMATIC_TAX | `'true'` | Auto tax calculation |
| SHIP_FROM_NAME | `'F.A.S. Motorsports LLC'` | Shipper name |
| SHIP_FROM_ADDRESS1 | `'6161 Riverside Dr'` | Shipper address |
| SHIP_FROM_CITY | `'Punta Gorda'` | Shipper city |
| SHIP_FROM_STATE | `'FL'` | Shipper state |
| SHIP_FROM_POSTAL | `'33982'` | Shipper ZIP |
| SHIP_FROM_COUNTRY | `'US'` | Shipper country |

**These are NOT secrets and can be committed to .env.example with defaults.**

---

## **Summary & Recommendations**

### **Immediate Actions (High Priority)**

1. **⚠️ REMOVE DANGEROUS VARIABLES:**
   - Delete all references to `VITE_STRIPE_SECRET_KEY`
   - Delete all references to `VITE_OPENAI_API_KEY`
   - These expose secrets to client bundles

2. **CONSOLIDATE SANITY TOKENS:**
   - Standardize on `SANITY_API_TOKEN` everywhere
   - Remove all 6 aliases (SANITY_WRITE_TOKEN, SANITY_ACCESS_TOKEN, etc.)

3. **CONSOLIDATE RESEND KEYS:**
   - Standardize on `RESEND_API_KEY`
   - Remove all 4 aliases (RESEND_KEY, RESEND_SECRET, etc.)

4. **VERIFY PRODUCTION SECRETS:**
   - Ensure all 8 required secrets are set in Netlify UI
   - Test `/selfCheck` endpoint in production

5. **UPDATE .env.example:**
   - Replace current .env.example with the authoritative version from this audit (Section 2)
   - Remove all legacy/unused variables

### **Medium Priority**

6. **REMOVE LEGACY EMAIL PROVIDERS:**
   - Delete all SendGrid, Mailgun, Postmark vars
   - Confirm Resend is the only email provider

7. **REMOVE NEXT.JS/VITE VARS:**
   - Delete all `NEXT_PUBLIC_*` variables
   - Delete all `VITE_*` variables (except the dangerous secret ones - delete those immediately)

8. **STANDARDIZE GOOGLE MERCHANT VARS:**
   - Choose either `GOOGLE_MERCHANT_*` or `GMC_*` prefix (recommend `GOOGLE_MERCHANT_*`)
   - Remove the other set

9. **CONSOLIDATE SHIP-FROM VARS:**
   - Remove `SHIP_FROM_POSTAL_CODE` (duplicate of `SHIP_FROM_POSTAL`)
   - Remove all `SENDER_*` vars (use `SHIP_FROM_*` instead)

### **Low Priority**

10. **CLEAN UP AWS VARS:**
    - Remove `AWS_SES_*` specific vars (use generic `AWS_*` instead)
    - Remove `AWS_DEFAULT_REGION` (use `AWS_REGION`)

11. **REMOVE UNUSED MARKETING VARS:**
    - Delete Klaviyo, affiliate, and direct analytics vars if not in use
    - Consolidate to Meta vars only

12. **DOCUMENT OPTIONAL FEATURES:**
    - Add comments to .env.example indicating which vars are needed for which features
    - Example: "Only required if using Google Ads Customer Match"

---

## **Final Environment Variable Count**

| Category | Count |
|----------|-------|
| **Total Unique Variables Referenced** | 260+ |
| **Required for Core Functionality** | 11 |
| **Critical Secrets (Must Set)** | 8 |
| **Business Config (Optional with Defaults)** | 25+ |
| **Feature-Specific (Optional)** | 75+ |
| **Duplicates/Aliases (Remove)** | 60+ |
| **Legacy/Unused (Remove)** | 100+ |
| **⚠️ Dangerous (Remove Immediately)** | 2 |

**Recommended Final Count After Cleanup:** ~90-110 environment variables

---

## **Conclusion**

This audit has identified:
- **2 critical security issues** (VITE_* secret exposure) requiring immediate action
- **60+ duplicate aliases** that should be consolidated
- **100+ legacy/unused variables** that can be removed
- **8 required secrets** that must be set in production
- **11 required variables** (secrets + non-secrets) for core functionality

The codebase currently has significant environment variable bloat due to historical accumulation of aliases, legacy integrations, and framework migrations (Next.js → Sanity Studio). Following the recommendations in this audit will:
- Improve security (remove client-exposed secrets)
- Reduce configuration complexity (90-110 vars vs 260+)
- Eliminate confusion (single canonical name per concept)
- Improve maintainability (clear .env.example)

**Next Steps:**
1. Apply immediate actions (dangerous vars, consolidation)
2. Update .env.example to authoritative version
3. Test using verification checklist
4. Deploy to production with clean env config
5. Document any optional features in project README

---

**End of Audit Report**

TASK: TypeScript Error Governance Audit (Single-Issue, Domain-Bounded)

EXECUTION CONTEXT:
This audit runs under the Full Governance Pipeline — Issue Wrapper:
Gemini → Claude → Codex → Guards

Command source of truth:
npx tsc --noEmit

No fixes, refactors, or implementations are permitted at any stage unless explicitly approved by Claude decision contracts.

---

ROLE & MODE (NON-NEGOTIABLE)

You are operating in STRICT READ-ONLY AUDIT MODE.

You are:
- NOT an implementer
- NOT a decision-maker
- NOT an optimizer

Your sole responsibility is to observe, trace, classify, and document factual behavior.

You MUST NOT:
- Propose fixes
- Suggest refactors
- Assume intent
- Collapse unrelated error causes
- Invent missing types, schema meaning, or runtime behavior

Absence of evidence MUST be explicitly reported as UNKNOWN.

---

ERROR SOURCE OF TRUTH

The sole authoritative input is the TypeScript compiler output produced by:

npx tsc --noEmit

Known facts:
- 80 total errors
- 28 files affected
- Errors span multiple unrelated domains including:
  - Auto-mapping and schema inference
  - Sanity schema definitions
  - Studio UI component prop contracts
  - Domain document models (Order, Invoice, Shipping)
  - Stripe SDK and API version typing
  - Scripts and migrations
  - API routes and external SDK boundaries

No other assumptions are allowed.

---

MANDATORY INTERNAL DOMAIN SEPARATION (CRITICAL)

Although this audit is issued as a SINGLE ISSUE, you MUST internally separate all findings into the following NON-OVERLAPPING domains.

Each error MUST belong to exactly one domain.

1) AutoMapper & Schema Inference
   - Missing symbols (e.g. SchemaIndex)
   - Implicit any
   - Inference collapse to never
   - Divergent inference paths

2) Sanity Schema Definitions vs Usage
   - Invalid access to `fields`
   - Missing required `name` in defineField
   - Schema typing mismatches

3) Studio UI Component Contracts
   - Invalid props (tone, icon, align, style)
   - Component API drift
   - React typing mismatches

4) Domain Document Type Drift
   - Missing properties (carrier, service, estimatedDeliveryDate)
   - Divergence between document definitions and consumers

5) Stripe SDK & API Versioning
   - Literal API version mismatches
   - SDK surface vs runtime usage differences

6) Scripts & Migration Typing Assumptions
   - Nullable vs required field assumptions
   - Script-only model expectations

7) API Routes & External SDK Boundaries
   - Missing properties on SDK objects
   - Static vs instance method misuse
   - Runtime behavior not reflected in type definitions

You MUST NOT merge findings across domains.

---

SEARCH SCOPE (MANDATORY)

You are NOT limited to the error lines themselves.

You MUST:
- Trace imports, referenced types, and upstream definitions
- Inspect Sanity schemas and generated types
- Inspect Studio UI consumers
- Inspect Stripe, Sanity, and other SDK boundaries
- Inspect scripts, migrations, and background jobs
- Identify where data or types are expected to originate
- Identify where inference, narrowing, or linkage fails

All file scope must be discovered from evidence, not assumed.

---

REQUIRED OUTPUTS (STOP AFTER THESE)

1) Primary Audit Report (Read-Only)

Save as:
docs/reports/typescript-error-governance-audit.md

For EACH domain:
- List all related errors (file + line)
- Identify expected source of missing type/property
- Identify observed actual source (or absence)
- Note whether logic executes in all cases
- Note whether queries exclude valid states
- Note whether UI fallbacks mask missing data
- Explicitly list known unknowns

NO fixes.
NO recommendations.

---

2) Claude Decision Contract Prompt (Derived Only)

Using ONLY the findings from the audit report, generate a Claude decision contract prompt.

Save as:
docs/prompts/claude-dec/typescript-error-governance-decision-contract.txt

Rules:
- Use only factual findings from the audit
- One decision section per domain
- Explicitly list:
  - Observed root causes
  - Affected files and logic paths
  - Conflicting type expectations
  - Unknowns requiring authoritative decisions
- Do NOT propose solutions
- Do NOT approve changes
- Do NOT write code

This prompt will be the sole authority for Claude’s binding decisions.

---

HARD STOP

STOP immediately after producing BOTH files above.
Do not output commentary, fixes, or suggestions.
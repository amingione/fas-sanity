AUDIT TASK — READ ONLY

Repository: fas-sanity

Objective:
Determine why Stripe product metadata (weight, dimensions, shipping class)
is incorrect or stale even though shippingConfig contains correct values.

This audit must identify WHERE Stripe metadata is generated and WHY it
diverges from shippingConfig.

DO NOT MODIFY CODE.
DO NOT PROPOSE FIXES YET.

--------------------------------------------------
KNOWN FACTS
--------------------------------------------------

- shippingConfig in Sanity is correct (e.g. 15 lbs, 32×24×24, standard)
- stripeMetadata field in Sanity is read-only
- Stripe metadata shows incorrect values (e.g. 25 lbs, oversized, wrong box)
- Checkout and EasyPost behave as if Stripe metadata is authoritative

Therefore:
Stripe metadata is being written or synced elsewhere.

--------------------------------------------------
QUESTIONS TO ANSWER (REQUIRED)
--------------------------------------------------

1. Where is Stripe product metadata written?
   - Stripe → Sanity webhook?
   - Sanity → Stripe sync function?
   - Backfill or migration script?
   - Admin tool or action?
   - Background job?

2. When is Stripe metadata written?
   - Product creation only?
   - On product update?
   - On explicit "sync" action?
   - Periodically?

3. Is shippingConfig ever used as input when writing Stripe metadata?
   - If yes, identify exact code path
   - If no, identify what source is used instead

4. Are there multiple writers of Stripe metadata?
   - Initial create vs later update
   - Conflicting scripts or webhooks

5. Is there any regeneration or backfill mechanism?
   - Manual trigger
   - Script
   - Admin action
   - API endpoint

6. Is Stripe metadata cached or snapshot-based?
   - Written once and never updated?
   - Copied from an older product state?

--------------------------------------------------
AREAS TO SEARCH
--------------------------------------------------

Search the repo for:
- stripe.products.create
- stripe.products.update
- stripeMetadata
- metadata:
- shipping_weight
- shipping_dimensions
- shipping_class
- sync
- backfill
- regenerate

Likely locations:
- packages/sanity-config/src/server/**
- packages/sanity-config/src/utils/**
- scripts/**
- admin or maintenance scripts
- webhook handlers

--------------------------------------------------
DELIVERABLE
--------------------------------------------------

Write a report to:

docs/reports/stripe-product-metadata-authority-audit.md

The report MUST include:
- Exact files/functions that write Stripe metadata
- Whether shippingConfig is used or ignored
- Whether Stripe metadata is stale, duplicated, or overridden
- Whether a re-sync mechanism exists
- A clear explanation of why values differ

STOP AFTER AUDIT.